---
title: "WIC Transaction Data"
output: html_notebook
---

1) Import Data from csv, skipping the rows which are in the header of the document, into R dataframes
2) Combine all dataframes into a single dataframe
3) Report out the number of unique families
4) Report out the average spending per family
5) Report out the average number of vendors a family uses

#getting the directory

```{r}
print(getwd())

```
#https://stackoverflow.com/questions/39110755/skip-specific-rows-using-read-csv-in-r

#Reading the first file for Guilford_County_Redemption_Week1, loading the data by skipping the documentation row from row 1 to row 14

```{r}
headers = read.csv("Guilford_County_Redemption_Week1.csv", skip = 14, header = F, nrows = 1, as.is = T)
Redemption_df1 = read.csv("Guilford_County_Redemption_Week1.csv", skip = 15, header = F)
colnames(Redemption_df1)= headers
```


#Reading the Second file for Guilford_County_Redemption_Week2, loading the data by skipping the documentation row from row 1 to row 14


```{r}
headers2 = read.csv("Guilford_County_Redemption_Week2.csv", skip = 14, header = F, nrows = 1, as.is = T)
Redemption_df2 = read.csv("Guilford_County_Redemption_Week2.csv", skip = 15, header = F)
colnames(Redemption_df2)= headers

```


#Reading the Third file for Guilford_County_Redemption_Week,3 loading the data by skipping the documentation row from row 1 to row 14


```{r}
headers3 = read.csv("Guilford_County_Redemption_Week3.csv", skip = 14, header = F, nrows = 1, as.is = T)
Redemption_df3 = read.csv("Guilford_County_Redemption_Week3.csv", skip = 15, header = F)
colnames(Redemption_df3)= headers

```


#2) combining all the 3 dataframes together

```{r}
WIC_Redemption_df<-rbind(Redemption_df1,Redemption_df2,Redemption_df3)

#write.csv(WIC_Redemption_df,"WIC_Redemption_df.csv")

```

#3) Report out the number of unique families
#https://dplyr.tidyverse.org/reference/distinct.html

#6617 unique families

# count of unique families

```{r}
length(unique(WIC_Redemption_df$`WIC Family ID`))

```
#reporting out unique families 

```{r}
library(dplyr)

Unique_WIC_family_df<-distinct(WIC_Redemption_df, WIC_Redemption_df$'WIC Family ID', .keep_all = TRUE)

```

#Renaming columns for easy identification

```{r}
colnames(WIC_Redemption_df)[23] <- "Requested_Amount"
colnames(WIC_Redemption_df)[13] <- "WIC_Family_Id"
colnames(WIC_Redemption_df)[25] <- "Authorization_Number"
colnames(WIC_Redemption_df)[27] <- "Vendor_Number"


```



#Renaming columns for easy identification

```{r}
colnames(Unique_WIC_family_df)[23] <- "Requested_Amount"
colnames(Unique_WIC_family_df)[13] <- "WIC_Family_Id"
colnames(Unique_WIC_family_df)[25] <- "Authorization_Number"

```



#4) Report out the average spending per family


```{r}

library(dplyr)
Average_spending_df<-WIC_Redemption_df %>%
   group_by(WIC_Family_Id, Authorization_Number) %>% 
   summarise(Avg_requested_amount = mean(Requested_Amount),No_of_items=n())
```


#5) Report out the average (mean and median) number of vendors a family uses
#for each family unique vendors
#find unique vendors, unique family ?
#WIC family id with mean vendors ? or count of vendors (Vendor id) 
#only 2 columns vendors and WIC family id? 

family - associated with vendor - unique vendor id
id - count of unique vendor id -
mean and median 

#count of unique vendors

```{r}
length(unique(WIC_Redemption_df$Vendor_Number))

```

#count number of vendors per item by grouping family and vendor number


```{r}
library(dplyr)
count_number_of_vendor_per_item<-WIC_Redemption_df %>%
   group_by(WIC_Family_Id, Vendor_Number) %>% 
   summarise(No_of_item_per_vendor=n())
```
# vendor number occurance for each families 

```{r}

unique_vendor_number_count_for_families=count_number_of_vendor_per_item %>% group_by(Vendor_Number) %>% tally()


```

#finding frequency or count for vendor used/occurance for each families

```{r}
library(sqldf)
Vendor_number_freq<-sqldf("SELECT WIC_Family_Id, Vendor_Number, COUNT(*) as Vendor_number_freq
       FROM count_number_of_vendor_per_item
       GROUP BY WIC_Family_Id")
```


#finding the mean and median for each familiy for vendor used


```{r}

Avg_Vendor_freq<-sqldf("SELECT WIC_Family_Id, Vendor_Number, Vendor_number_freq, avg(Vendor_number_freq), median (Vendor_number_freq)
       FROM Vendor_number_freq
       GROUP BY WIC_Family_Id,Vendor_Number ")

Avg_Vendor_freq$mean_vendor <- Avg_Vendor_freq$Vendor_number_freq
Avg_Vendor_freq$median_vendor <- Avg_Vendor_freq$Vendor_number_freq

```



#Data visualizations

#Reporting average spending for each family

```{r}
library(ggplot2)
library(dplyr)


```
#shows the average spending for each family
```{r}
ggplot(Average_spending_df, aes(x=WIC_Family_Id, y=Average_spending_df$Avg_requested_amount )) + 
    geom_point(
      color="orange",
        fill="#69b3a2",
        shape=21,
        alpha=0.5,
        size=6,
        stroke = 2
    )
```
#vendor count distribution
```{r}
barplot(height= Vendor_number_freq$Vendor_number_freq , names=Vendor_number_freq$Vendor_Number , 
        col=rgb(0.8,0.1,0.1,0.6),
        xlab="Vendor number", 
        ylab="Vendor count", 
        main="Vendor count distribution", 
        ylim=c(0,10)
        )




```
```{r}



























```

